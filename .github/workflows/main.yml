name: Deploy Databricks Notebooks

on:
  push:
    branches:
      - main  # Adjust the branch name as needed

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Databricks CLI
        uses: microsoft/install-databricks-cli@v1.0.0
        with:
          db_api_token: ${{ secrets.DATABRICKS_TOKEN }}
          db_workspace_url: ${{ secrets.DATABRICKS_HOST }} # Replace with your Databricks workspace URL

      - name: Import notebooks to Databricks
        run: |
          # Iterate through notebooks in the repository
          find . -name '*.py' | while read notebook_file; do
            databricks workspace import -o --language PYTHON "$notebook_file" "$DATABRICKS_WORKSPACE_PATH"
          done
        env:
          DATABRICKS_WORKSPACE_PATH: /Users/prathamesh.bhamare@celebaltech.com/imported_notebooks  # Replace with your desired Databricks workspace path
